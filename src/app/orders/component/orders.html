<p-toast></p-toast>
<p-confirmdialog></p-confirmdialog>

<p-toolbar>
    <ng-template #start>
        <p-button label="New" icon="pi pi-plus" severity="secondary"
            class="mr-2" (onClick)="openNew()" />
    </ng-template>

    <ng-template #end>
        <div class="flex items-center gap-2">
            <label for="date_from" class="mr-1">Desde:</label>
            <p-datepicker [(ngModel)]="date_from" (onSelect)="getOrders()"
                dateFormat="yy-mm-dd" id="date_from"
                placeholder="Date From"></p-datepicker>
            <label for="date_to" class="mr-1">Hasta:</label>
            <p-datepicker [(ngModel)]="date_to" (onSelect)="getOrders()"
                dateFormat="yy-mm-dd" placeholder="Date To" id="date_to"></p-datepicker>
        </div>
    </ng-template>
</p-toolbar>

<p-table #dt [value]="lista" [rows]="perPage" [paginator]="true" [lazy]="true"
    [tableStyle]="{ 'min-width': '75rem' }"
    [rowHover]="true" (onPage)="onPageChange($event)" [totalRecords]="total"
    dataKey="id" [(first)]="first"
    currentPageReportTemplate="Showing {first} to {last} of {totalRecords} orders"
    [showCurrentPageReport]="true" (onSort)="onSort($event)">
    <ng-template #caption>
        <div class="flex items-center justify-between">
            <h5 class="m-0">Manage Orders</h5>
            <div>

                <p-select id="type" [(ngModel)]="type" [options]="orderTypes"
                    optionLabel="name" optionValue="value"
                    (onChange)="getOrders()" placeholder="Select Type"
                    class="w-full"></p-select>
            </div>
        </div>
    </ng-template>

    <ng-template #header>
        <tr>
            <th style="min-width: 3rem">Id </th>
            <th style="min-width: 3rem"> </th>
            <th style="min-width: 3rem">Status </th>
            <th style="min-width: 3rem">Waiter Owner</th>
            <th style="min-width: 3rem">Date</th>
            <th style="min-width: 5rem">Final Price</th>
            <th style="min-width: 5rem">Waiter Comision</th>
            <th style="min-width: 3rem">Updated Date</th>
        </tr>
    </ng-template>
    <ng-template #body let-order>
        <tr>
            <td>{{order.id}}</td>
            <td></td>
            <td>
                <p-tag [value]="order.status"
                    [severity]="getStatusSeverity(order.status)"></p-tag>
            </td>

            <td>{{order.waiter?.username}}</td>
            <td>{{order.order_date | date:'yyyy-MM-dd'}}</td>
            <td>{{order.price_final | currency:'USD'}}</td>
            <td>{{order.waiter_commission | currency:'USD'}}</td>
            <td>{{order.updated_at | date:'yyyy-MM-dd'}}</td>
        </tr>
    </ng-template>
</p-table>
